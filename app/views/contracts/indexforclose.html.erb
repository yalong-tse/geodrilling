<% content_for(:title, "合同关闭") %>
<% content_for(:page_header_description, "关闭已经施工完成的合同") %>
<%= content_for :page_specific_stylesheets do %>
  <%= stylesheet_link_tag 'jquery-ui-1.10.3.custom.min' %>
  <%= stylesheet_link_tag 'jquery.gritter.css' %>
<% end %>
<table id="_table_contract" class="table table-striped table-bordered table-hover">
  <thead>
  <tr>
    <th>合同编号</th>
    <th>合同名称</th>
    <th>项目名称</th>
    <th>业主</th>
    <th>乙方</th>
    <th>合同金额</th>
    <th>开始日期</th>
    <th>完成日期</th>
    <th>合同状态</th>
    <th>操作</th>
  </tr>
</thead>
<tbody></tbody>
</table>
</div>
<div id="_close_modal" class="modal hide fade">
  <div class="model-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    <h5>您确认需要归档该合同吗</h5>
  </div>
  <div class="modal-body">
    <table class="table table-striped table-hover table-bordered">
      <tr>
        <td width="30%">合同名称</td>
        <td width="70%"><span id="_contract_name" class="label label-important"></span></td>
      </tr>
      <tr>
        <td>项目名称</td>
        <td><span id="_project_name"class="label label-important"></span></td>
      </tr>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal"><i class="icon-undo"></i>否</button>
    <a href="#"  class="btn btn-primary" onclick="close_contract()"><i class="icon-ok"></i>是</a>
  </div>
</div>
<% content_for :page_specific_javascripts do %>
  <%= javascript_include_tag 'jquery.dataTables.min' %>
  <%= javascript_include_tag 'jquery.dataTables.bootstrap' %>
<% end %>

<% content_for :inline_javascripts do %>
<script language="javascript">
  var _contractno; 
  $(function(){
      var oTable1=$("#_table_contract").dataTable({
        "aoColumns":[null,null,null,null,null,null,null,null,null,{"bSortable":false}],
        "bServerSide":true,
        "bAutoWidth" :false,
        "sAjaxSource":"<%=contracts_indexforclose_path(:format=>:json) %>",
        "oLanguage":{
        "sLengthMenu":"每页 _MENU_",
        "sZeroRecords":"对不起,没有数据",
        "sInfo":"显示 _START_ 到 _END_ ,总计_TOTAL_数据",
        "sInfoEmpty":"显示 0 到 0 , 总计0条数据",
        "sSearch": "检索",
        "sProcessing": "系统正在处理...",
        "sInfoFiltered":"(过滤_MAX_数据)" },
        "sDom": "<'row-fluid'<'span6'l><'span6'<'dt-search'>>r>t<'row-fluid'<'span4'i><'span8'p>>"
        }
        );

    $("div.dt-search").html("<input id='dt-search-input' type='text''><button id='dt-search-btn' class='btn btn-mini'><i class='icon-search'></i></button>");
    $("#dt-search-btn").click(function(){
      var filterString = $('#dt-search-input').val();
      oTable1.fnFilter(filterString);
    });

  });

  function open_modal(contractno,contractname,projectname)
  {
    _contractno = contractno; 
    $("#_contract_name").html(contractname);
    $("#_project_name").html(projectname);
    $("#_close_modal").modal();
  }

  function close_contract()
  {
    //alert("the contractno is:"+ _contractno);

    $.post("<%=contracts_archive_path%>?contractno="+ _contractno,
    {
    },
    function(result){
      if(result=="true")
      {
        alert("111");
        $("#_close_modal").modal("hide");
        $("#_table_contract").dataTable.fnDraw();
        $("#_table_contract").dataTable.fnReloadAjax();
      }
    });

  }
</script>
<% end %>
