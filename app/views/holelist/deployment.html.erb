<% content_for(:title, "钻孔配置" ) %>
<% content_for(:page_header_description, "分别选择施工队伍、使用设备和使用材料配置钻孔所需的人员、设备和材料") %>
<%= render partial: "layouts/flash_messages" %>
<%= form_for(:holelist,:url=>holelist_create_path,:html=>{:class=>"form-horizontal" , :id=>"formservice"}) do |f| %>
  <input type="hidden" name="holeid" value="<%=@hole.id %>" />
  <div class="row-fluid">
    <div class="span12">
      <div class="control-group">
        <%= f.label "矿区" ,:class=>"control-label" %>
        <div class="controls">
          <%= text_field_tag "minearea", @hole.minearea, :class=>"span8" , :disabled=>true %>
        </div>
      </div>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span5">
      <div class="control-group">
        <%= f.label "合同名称" , :class=>"control-label" %>
        <div class="controls">
          <%=text_field_tag "contractname", @hole.contract.name, :disabled=>true ,:class=>"input-xlarge"  %>
        </div>
      </div>
    </div>
    
    <div class="span5">
      <div class="control-group">
        <%= f.label "孔号", :class=>"control-label" %>
        <div class="controls">
          <%= text_field_tag "holenumber", @hole.holenumber, :disabled=>true, :class=>"input-large" %>
        </div>
      </div>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span5">
      <div class="control-group">
        <%= f.label "机长" ,:class=>"control-label" %>
        <div class="controls">
          <%=f.select(:user, options_for_select({"机长一"=>"1", "机长二"=>"2"}) , :class=>"chzn-select" , :prompt=>"请选择...")  %>
        </div>
      </div>
    </div>

    <div class="span5">
      <div class="control-group">
        <%=f.label "班长" , :class=>"control-label" %>
        <div class="controls">
          <%= text_field_tag "holenumber","",:disabled=>true, :class=>"input-xlarge" %>
        </div>
      </div>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span5">
      <div class="control-group">
        <%=f.label "钻塔" , :class=>"control-label" %>
        <div class="controls">
          <span class="input-icon">
            <input type="hidden" id="drilltowerid" name="drilltowerid" value="<%=@deployment.drilltower_id if @deployment && @deployment.drilltower_id  %>" />
            <input type="text" id="drilltower" name="drilltower", class="input-large" onclick="javascript:open_drilltower_modal();" value="<%= "设备编号:" + @deployment.drilltower.devicenumber if @deployment && @deployment.drilltower  %>"><i class="icon-leaf"></i>
          </span>
        </div>
      </div>
    </div>

    <div class="span5">
      <div class="control-group">
        <%=f.label "钻机" , :class=>"control-label" %>
        <div class="controls">
          <span class="input-icon">
            <input type="hidden" id="rigmachineid" name="rigmachineid" value="<%=@deployment.rigmachine_id if @deployment && @deployment.rigmachine_id%>" />
            <input type="text" id="rigmachine" name="rigmachine", class="input-large" onclick="javascript:open_rigmachine_modal();" value="<%="设备编号" + @deployment.rigmachine.devicenumber if @deployment && @deployment.rigmachine %>"><i class="icon-leaf"></i>
          </span>
        </div>
      </div>
    </div>
  </div>
  
  <div class="row-fluid">
    <div class="span5">
      <div class="control-group">
        <%=f.label "泥浆泵" , :class=>"control-label" %>
        <div class="controls">
          <span class="input-icon">
            <input type="hidden" id="pumpid" name="pumpid" value="<%=@deployment.pump if @deployment && @deployment.pump_id %>" />
            <input type="text" id="pump" name="pump" class="input-large" onclick="javascript:open_pump_modal();" value="<%="设备编号："+@deployment.pump.devicenumber if @deployment && @deployment.pump %>"><i class="icon-leaf"></i>
          </span>
        </div>
      </div>
    </div>

    <div class="span5">
      <div class="control-group">
      </div>
    </div>
  </div>

  <div class="form-actions">
    <%=f.submit "保存" , :class=>"btn btn-primary" %>
    <%=link_to "返回", holelist_index_path, :class=>"btn btn-info" %>
  </div>

<div id="_rigmachine_modal" class="modal hide fade widget-box">
  <div class="model-header widget-header widget-header-flat">
    <h5>请选择配置给该孔的钻机</h5>
    <div class="widget-toolbar">
      <label>
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
     </label>
    </div>
  </div>
  <div class="modal-body widget-body">
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <th>选择</th>
        <th>设备编号</th>
        <th>钻机重量</th>
        <th>钻孔深度</th>
        <th>钻机功率</th>
         <th>转速</th>
         <th>钻孔直径</th>
         <th>厂商</th>
         <th>占用状态</th>
      </thead>
      <tbody>
        <% @rigmachine.each do |rig| %>
          <tr>
            <td class="center"><input type="radio" name="rig" value="<%=rig.id%>" style="opacity:100;position:relative"/></td>
            <td><%= rig.devicenumber %> </td>
            <td><%= rig.rigweight %></td>
            <td><%= rig.righoleDeep %></td>
            <td><%= rig.rigPower %></td>
            <td><%= rig.rotatingSpeed %></td>
            <td><%= rig.pipeDiameter %></td>
            <td><%= rig.manufacture%></td>
            <td><%= rig.status%></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal"><i class="icon-undo"></i>取消</button>
    <a href="#"  class="btn btn-primary" onclick="set_rigmachine()"><i class="icon-ok"></i>确定</a>
  </div>
</div>


<div id="_drilltower_modal" class="modal hide fade widget-box">
  <div class="model-header widget-header widget-header-flat">
    <h5>请选择配置给该孔的钻塔</h5>
    <div class="widget-toolbar">
      <label>
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
     </label>
    </div>
  </div>
  <div class="modal-body widget-body">
    <table class="table table-striped table-bordered table-hover">
      <thead>
          <th>选择</th>
          <th>设备编号</th>
          <th>型号</th>
          <th>有效载荷</th>
          <th>深度</th>
          <th>高度</th>
          <th>提升钻杆根数与长度</th>
          <th>滑车组数与减轻负荷倍数</th>
          <th>顶宽尺寸</th>
          <th>重量</th>
          <th>厂商</th>
          <th>占用状态</th>
      </thead>
      <tbody>
        <% @drilltower.each do |tower| %>
          <tr>
            <td class="center"><input type="radio" name="tower" value="<%=tower.id%>" style="opacity:100;position:relative"/></td>
            <td><%= tower.devicenumber %> </td>
            <td><%= tower.model %></td>
            <td><%= tower.effectiveload%></td>
            <td><%= tower.deep %></td>
            <td><%= tower.height %></td>
            <td><%= tower.pipequantityAndLenght %></td>
            <td><%= tower.sheaveQuantity%></td>
            <td><%= tower.topsize%></td>
            <td><%= tower.weight%></td>
            <td><%= tower.manufacture%></td>
            <td><%= tower.status%></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal"><i class="icon-undo"></i>取消</button>
    <a href="#"  class="btn btn-primary" onclick="set_drilltower()"><i class="icon-ok"></i>确定</a>
  </div>
</div>


<div id="_pump_modal" class="modal hide fade widget-box">
  <div class="model-header widget-header widget-header-flat">
    <h5>请选择配置给该孔的泥浆泵</h5>
    <div class="widget-toolbar">
      <label>
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
     </label>
    </div>
  </div>
  <div class="modal-body widget-body">
    <table class="table table-striped table-bordered table-hover">
      <thead>
          <th>选择</th>
          <th>设备编号</th>
          <th>型号</th>
          <th>缸径</th>
          <th>缸数</th>
          <th>冲程</th>
          <th>冲次</th>
          <th>流量</th>
          <th>重量</th>
          <th>功率</th>
          <th>压力</th>
          <th>外观尺寸</th>
          <th>占用状态</th>
      </thead>
      <tbody>
        <% @pump.each do |pump| %>
          <tr>
            <td class="center"><input type="radio" name="pump" value="<%=pump.id%>" style="opacity:100;position:relative"/></td>
            <td><%= pump.devicenumber %> </td>
            <td><%= pump.pumpmodel %></td>
            <td><%= pump.pumpDiameter%></td>
            <td><%= pump.pumplineNumber %></td>
            <td><%= pump.stroke %></td>
            <td><%= pump.strokeTimes %></td>
            <td><%= pump.traffic %></td>
            <td><%= pump.weight %></td>
            <td><%= pump.power %></td>
            <td><%= pump.pressure %></td>
            <td><%= pump.overallsize %></td>
            <td><%= pump.status %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal"><i class="icon-undo"></i>取消</button>
    <a href="#"  class="btn btn-primary" onclick="set_pump()"><i class="icon-ok"></i>确定</a>
  </div>
</div>

<% end %>
<% content_for :page_specific_javascripts do %>
  <%= javascript_include_tag 'jquery.dataTables.min' %>
  <%= javascript_include_tag 'chosen.jquery.min' %>
  <%= javascript_include_tag 'jquery.dataTables.bootstrap' %>
<% end %>
<% content_for :page_specific_stylesheets do %>
  <%= stylesheet_link_tag 'chosen' %>
  <style>
    #_rigmachine_modal{
      width:900px;
      margin:10px 0 0 -450px;
      }

    #_drilltower_modal{
      width:1024px;
      margin:10px 0 0 -450px;
      }
    #_pump_modal{
      width:1024px;
      margin:10px 0 0 -450px;
      }
  </style>
<% end %>

<% content_for :inline_javascripts do %>
<script language="javascript">

  $(function(){
    $(".chzn-select").chosen();

  $("#formservice").validate({
    rules:{
    "rigmachine":{required:true},
    "drilltower":{required:true},
    "pump":{required:true},
    "holelist[user]":{required:true}
    },
  messages:{
  "rigmachine":{required:"请选择钻机"},
  "drilltower":{required:"请选择钻塔"},
  "pump":{required:"请选择泥浆泵"},
  "holelist[user]":{required:"请选择机长"}

    }
    });

  });

  function open_rigmachine_modal()
  {
    $("#_rigmachine_modal").modal();
  }

  function open_pump_modal()
  {
    $("#_pump_modal").modal();
  }

  function open_drilltower_modal()
  {
    $("#_drilltower_modal").modal();
  }

  function set_rigmachine()
  {
    var _id = $(":radio[name='rig']:checked").val();
    var _devicenumber = $(":radio[name='rig']:checked").parent().parent().find("td:eq(1)").html();
    $("#rigmachineid").val(_id);
    $("#rigmachine").val("设备编号："+_devicenumber);
    $("#_rigmachine_modal").modal("hide");
  }

  function set_pump()
  {
    var _id = $(":radio[name='pump']:checked").val();
    var _devicenumber = $(":radio[name='pump']:checked").parent().parent().find("td:eq(1)").html();
    $("#pumpid").val(_id);
    $("#pump").val("设备编号：" + _devicenumber);
    $("#_pump_modal").modal("hide");
  }

  function set_drilltower()
  {
    var _id = $(":radio[name='tower']:checked").val();
    var _devicenumber = $(":radio[name='tower']:checked").parent().parent().find("td:eq(1)").html();
    $("#drilltowerid").val(_id);
    $("#drilltower").val("设备编号：" + _devicenumber);
    $("#_drilltower_modal").modal("hide");
  }

</script>
<% end %>
