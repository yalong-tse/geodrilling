<% content_for(:title,"钻孔查询") %>
<% content_for(:page_header_description, "查询钻孔的相关信息，检索框中输入内容即可条件检索") %>
<div class="row-fluid">
<table class="table table-striped" id="_hole_table">
<thead>
  <tr>
    <th>孔号</th>
    <th>合同名称</th>
    <th>设计深度</th>
    <th>当前深度</th>
    <th>设计取心率</th>
    <th>实际取心率</th>
    <th>开孔日期</th>
    <th>钻孔状态</th>
    <th>查看详情</th>
  </tr>
</thead>
<tbody>
</tbody>
</table>
</div>

<div id="_holes_modal" class="modal hide fade">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
    <h5>钻孔详情</h5>
  </div>
  <div class="modal-body">
<table class="table table-striped table-hover table-bordered">
  <tr>
    <td>矿区</td>
    <td id="_minearea"></td>
  </tr>
  <tr>
    <td>钻孔编号</td>
    <td id="_holenumber"></td>
  </tr>
  <tr>
    <td>设计终孔深度</td>
    <td id="_designdeep"></td>
  </tr>
  <tr>
    <td>当前深度</td>
    <td id="_actualdeep"></td>
  </tr>
  <tr>
    <td>设计终孔直径</td>
    <td id="_designdiameter"></td>
  </tr>
  <tr>
    <td>实际钻孔直径</td>
    <td id="_actualdiameter"></td>
  </tr>
  <tr>
    <td>设计钻孔顶角</td>
    <td id="_designapexangle"></td>
  </tr>
  <tr>
    <td>实际钻孔顶角</td>
    <td id="_actualapexangle"></td>
  </tr>
  <tr>
    <td>设计岩心采取率</td>
    <td id="_designcoreratio"></td>
  </tr>
  <tr>
    <td>实际岩心采取率</td>
    <td id="_actualcoreratio"></td>
  </tr>
  <tr>
    <td>钻探目的</td>
    <td id="_drillingpurpose"></td>
  </tr>
  <tr>
    <td>钻孔状态</td>
    <td id="_status"></td>
  </tr>
  <tr>
    <td>设计书</td>
    <td id="_designbook"></td>
  </tr>
  <tr>
    <td>备注</td>
    <td id="_remark"></td>
  </tr>
</table>
  </div>
  <div class="modal-footer">
    <button class="btn btn-info" data-dismiss="modal"><i class="icon-reply"></i>关闭</button>
  </div>
</div>
<% content_for :page_specific_javascripts do %>
  <%= javascript_include_tag 'jquery.dataTables.min' %>
  <%= javascript_include_tag 'jquery.dataTables.bootstrap' %>
<% end %>

<% content_for :inline_javascripts do %>
<script language="javascript">
  $(function(){
    $("a").bind('ajax:success',function(event,data,status,xhr){
      ("#_minearea").html(data.minearea);
    }).bind('ajax:error',function(event,xhr,status,error){});

    $("div.dt-search").html("<input id='dt-search-input' type='text''><button id='dt-search-btn' class='btn btn-mini'><i class='icon-search'></i></button>");

    $("#dt-search-btn").click(function(){
      var filterString = $('#dt-search-input').val();
      oTable1.fnFilter(filterString);
    });
  });

   var oTable1=$("#_hole_table").dataTable({
        "aoColumns":[null,null,null,null,null,null,null,null,{"bSortable":false} ],
        "bProcessing":true,
        "bServerSide":true,
        "bAutoWidth" : false,
        "sAjaxSource":"<%=holes_path(:format=>:json) %>",
        "oLanguage":{
        "sLengthMenu":"每页 _MENU_",
        "sZeroRecords":"对不起,没有数据",
        "sInfo":"显示 _START_ 到 _END_ ,总计_TOTAL_数据",
        "sInfoEmpty":"显示 0 到 0 , 总计0数据",
        "sSearch": "检索",
        "sProcessing": "系统正在处理...",
        "sInfoFiltered":"(过滤_MAX_数据)" },
        "sDom": "<'row-fluid'<'span6 offset6'<'dt-search'>>r>t<'row-fluid'<'span4'i><'span8'pl>>"
        }
     );

  function open_detail(url)
  {
    $.getJSON(url,{},function(data){
      $("#_holes_modal").modal();
      $("#_minearea").html(data.minearea);
      $("#_holenumber").html(data.holenumber);
      $("#_designdeep").html(data.designdeep);
      $("#_actualdeep").html(data.actualdeep);
      $("#_designdiameter").html(data.designdiameter);
      $("#_actualdiameter").html(data.actualdiameter);
      $("#_designapexangle").html(data.designapexangle);
      $("#_actualapexangle").html(data.actualapexangle);
      $("#_designcoreratio").html(data.designcoreratio);
      $("#_actualcoreratio").html(data.actualcoreratio);
      $("#_drillingpurpose").html(data.drillingpurpose);
      $("#_status").html(data.statusstr);
      $("#_remark").html(data.remark);
      $("#_designbook").html(data.attachmentstr);
    });
  }

  function open_tourreports(url)
  {
    window.location.href=url;
  }

  function new_tourreports(url)
  {
    window.location.href=url;
  }

  function open_schedule_tourreports(url)
  {
    window.location.href=url;
  }
</script>
<% end %>
