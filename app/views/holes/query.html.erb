<% content_for(:title,"钻孔查询") %>
<% content_for(:page_header_description, "查询钻孔的相关信息，检索框中输入内容即可条件检索") %>

<div class="row"> 
  <%= form_tag holes_query_path, :class=>"form-horizontal" do %>
  	<div class="span4">
       <div class="control-group">
          <%= label_tag :holenumber, "钻孔编号", :class => "control-label" %>
          <div class="controls">
            <div class="input-prepend">
              <%= text_field_tag :holenumber, params[:holenumber], :placeholder => "钻孔编号" %>
            </div>
          </div>
        </div>

       <div class="control-group">
          <%= label_tag :contractname, "合同名称", :class => "control-label" %>
          <div class="controls">
            <div class="input-prepend">
              <%= text_field_tag :contractname, params[:contractname], :placeholder => "合同名称" %>
            </div>
          </div>
        </div>

       <div class="control-group">
          <%= label_tag :minearea, "矿区名称", :class => "control-label" %>
          <div class="controls">
            <div class="input-prepend">
              <%= text_field_tag :minearea, params[:minearea], :placeholder => "矿区名称" %>
            </div>
          </div>
        </div>

		</div>

		<div class="span4">
       <div class="control-group">
          <%= label_tag :departmentid, "部门名称", :class => "control-label" %>
          <div class="controls">
            <div class="input-prepend">
      			<%= select_tag(:departmentid ,options_for_select(Department.to_select, params[:departmentid]),:prompt=>"请选择") %>
            </div>
          </div>
        </div>

       <div class="control-group">
          <%= label_tag :contractname, "管理方式", :class => "control-label" %>
          <div class="controls">
            <div class="input-prepend">
			  <select name="outerflag">
			  	<option value="2" <% if params[:outerflag]=="2" %> selected <% end %>>所有</option>
			  	<option value="0" <% if params[:outerflag]=="0" %> selected <% end %>>自管</option>
			  	<option value="1" <% if params[:outerflag]=="1" %> selected <% end %>>外协</option>
			  </select>
            </div>
          </div>
        </div>

		
        <div class="control-group">
          <div class="controls">
            <%= submit_tag "查询", :class => "btn-small btn-primary" %>
          </div>
        </div>
		</div>
  <% end %>
</div>

<div class="row-fluid">
<table class="table table-striped table-bordered table-hover" id="_hole_table">
<thead>
  <tr>
  	<th>公司名称</th>
    <th style="text-align:center">合同名称</th>
    <th>孔号</th>
    <th style="text-align:center">矿区</th>
    <th>设计深度(m)</th>
    <th>当前深度(m)</th>
    <th>设计取心率(%)</th>
    <th>实际取心率(%)</th>
    <th>开孔日期</th>
    <th>钻孔状态</th>
    <th>查看详情</th>
  </tr>
</thead>
<tbody>
  <% @holes.each do |hole| %>
    <tr>
      <td class="center"><% if(hole.contract) %><%= hole.contract.department.name %><% end %></td>
      <td class="center"><%= hole.contract.name %> </td>
      <td class="center"><%= holenumber_dealing2 hole.id %> </td>
      <td class="center"><%= hole.minearea %> </td>
      <td class="center"><%= hole.designdeep %> </td>
      <td class="center"><%= hole.actualdeep %> </td>
      <td class="center"><%= hole.designcoreratio %> </td>
      <td class="center"><%= hole.actualcoreratio %> </td>
      <td class="center"><%= hole.startdate.strftime("%Y-%m-%d") %> </td>
      <td class="center"><%= hole.statusstr %> </td>

      <td class="center">
    	<div class="inline position-relative btn-group">
    	<button class="btn btn-mini btn-success tooltip-success" onclick='open_detail( "<%=hole_path(hole)%> ")' rel="tooltip" title="查看详情"><i class="icon-eye-open bigger-120"></i></button>"
     <% if(hole.status.nil? || hole.status==1) %>
       <button class="btn btn-mini btn-success tooltip-success" onclick='open_detail("<%=holes_close_path%>?id=<%=hole.id.to_s%>")' rel="tooltip" title="钻孔终孔")><i class="icon-cogs bigger-120"></i></button>
    <% end %>
     </div>
	  </td>
    </tr>
  <% end %>
</tbody>
</table>
</div>
<div class="digg_pagination">
	<div class="page_info">
	<%= will_paginate @holes, :container=>false %>
	</div>
</div>

<% content_for :page_specific_javascripts do %>
  <%= javascript_include_tag 'jquery.dataTables.min' %>
  <%= javascript_include_tag 'jquery.dataTables.bootstrap' %>
<% end %>

<% content_for :inline_javascripts do %>
<script language="javascript">
  $(function(){
    $("a").bind('ajax:success',function(event,data,status,xhr){
      ("#_minearea").html(data.minearea);
    }).bind('ajax:error',function(event,xhr,status,error){});

    $("div.dt-search").html("<input id='dt-search-input' type='text''><button id='dt-search-btn' class='btn btn-mini'><i class='icon-search'></i></button>");

    $("#dt-search-btn").click(function(){
      var filterString = $('#dt-search-input').val();
      oTable1.fnFilter(filterString);
    });
  });

//   var oTable1=$("#_hole_table").dataTable({
//        "aoColumns":[null,null,null,null,null,null,null,null,{"bSortable":false} ],
//        "bServerSide":true,
//        "bAutoWidth" : false,
//        "sAjaxSource":"<%=holes_path(:format=>:json) %>",
//        "oLanguage":{
//        "sLengthMenu":"每页 _MENU_",
//        "sZeroRecords":"对不起,没有数据",
//        "sInfo":"显示 _START_ 到 _END_ ,总计_TOTAL_数据",
//        "sInfoEmpty":"显示 0 到 0 , 总计0数据",
//        "sSearch": "检索",
//        "sProcessing": "系统正在处理...",
//        "sInfoFiltered":"(过滤_MAX_数据)" },
//        "sDom": "<'row-fluid'<'span6'l><'span6'<'dt-search'>>r>t<'row-fluid'<'span4'i><'span8'p>>"
//        }
//     );

  function open_detail(url)
  {
    window.location.href=url;
  }

  function open_tourreports(url)
  {
    window.location.href=url;
  }

  function new_tourreports(url)
  {
    window.location.href=url;
  }

  function open_schedule_tourreports(url)
  {
    window.location.href=url;
  }
</script>
<% end %>
